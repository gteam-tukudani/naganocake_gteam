<div class="container">
  <h2>注文履歴詳細</h2>
  <%= form_with model: @order, url: orders_path, method: :get, local: true do |f| %>
    <table class="table">
      <tr>
        <th>注文日</th>
        <td><%= l @order.created_at, format: :month_day %></td>
      </tr>
      <tr>
        <th>配送先</th>
        <td>
          〒 <%= @order.postal_code %> <%= @order.address %><br />
          <%= @order.name %>
        </td>
      </tr>
      <tr>
        <th>支払い方法</th>
        <td><%= @order.payment_method_i18n%></td>
      </tr>
      <tr>
        <th>ステータス</th>
        <td><%= @order.status_i18n %></td>
      </tr>
    </table>
  <% end %>

  <h3>注文商品</h3>
  <table class="table">
    <thead>
      <tr>
        <th>商品</th>
        <th>単価</th>
        <th>個数</th>
        <th>小計</th>
      </tr>
    </thead>
    <tbody>
      <% @sum = 0 %>
      <% @order.order_details.each do |detail| %>
        <tr>
          <td><%= detail.item.name %></td>
          <td><%= detail.price %>円</td>
          <td><%= detail.amount %></td>
          <% subtotal = detail.price * detail.amount %>
          <% @sum += subtotal %>
          <td><%= subtotal %>円</td>
        </tr>
      <% end %>
    </tbody>
  </table>

  <h3>合計金額</h3>
  <table class="table">
    <tr>
      <th>商品合計</th>
      <td><%= @sum %>円</td>
    </tr>
    <tr>
      <th>配送料</th>
      <td>800円</td>
    </tr>
    <tr>
      <th>ご請求額</th>
      <td><%= @order.total_payment %>円</td>
    </tr>
  </table>
</div>


